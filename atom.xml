<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Zhen Lu&#39;s blog</title>
<link>https://leslie-lu.github.io/atom.html</link>
<atom:link href="https://leslie-lu.github.io/atom.xml" rel="self" type="application/rss+xml"/>
<description>Zhen Lu&#39;s blog</description>
<language>en</language>
<generator>quarto-1.4.555</generator>
<lastBuildDate>Fri, 07 Jun 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>å¸¸ç”¨æŸå¤±å‡½æ•°</title>
  <dc:creator>Zhen Lu</dc:creator>
  <link>https://leslie-lu.github.io/blog/2024/06/07/loss_function/</link>
  <description><![CDATA[ 





<section id="loss-function" class="level3">
<h3 class="anchored" data-anchor-id="loss-function">loss function</h3>
<p>åœ¨æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œè¡¡é‡æ¨¡å‹é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚çš„æŒ‡æ ‡ç§°ä¸ºæŸå¤±å‡½æ•°ã€‚æŸå¤±å‡½æ•°æ˜¯æ¨¡å‹è®­ç»ƒçš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–æ¨¡å‹å‚æ•°ï¼Œä½¿å¾—æ¨¡å‹çš„é¢„æµ‹å€¼æ›´åŠ æ¥è¿‘çœŸå®å€¼ã€‚é¢„æµ‹ä»»åŠ¡çš„ç›®æ ‡ä¹Ÿæ˜¯æœ€å°åŒ–æŸå¤±å‡½æ•°ï¼Œå¦‚ï¼Œæˆ‘ä»¬åˆ©ç”¨åå‘ä¼ æ’­ç®—æ³•ç­‰æ–¹æ³•ï¼Œé€šè¿‡æ›´æ–°æŸå¤±å‡½æ•°ç›¸å¯¹äºæ¨¡å‹å‚æ•°çš„æ¢¯åº¦æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ï¼Œæé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œæœ‰æ•ˆçš„æŸå¤±å‡½æ•°è¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¹³è¡¡æ¨¡å‹çš„åå·®å’Œæ–¹å·®ï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<p>ä¾æ®é¢„æµ‹ä»»åŠ¡çš„ä¸åŒï¼ŒæŸå¤±å‡½æ•°å¯ä»¥åˆ†ä¸ºå›å½’ä»»åŠ¡å’Œåˆ†ç±»ä»»åŠ¡ä¸¤å¤§ç±»ã€‚å›å½’ä»»åŠ¡çš„æŸå¤±å‡½æ•°é€šå¸¸æ˜¯å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰æˆ–å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰ï¼Œè€Œåˆ†ç±»ä»»åŠ¡çš„æŸå¤±å‡½æ•°åˆ™æœ‰äº¤å‰ç†µæŸå¤±å‡½æ•°ã€HingeæŸå¤±å‡½æ•°ç­‰ã€‚æœ¬æ–‡å°†ä»‹ç»å¸¸ç”¨çš„æŸå¤±å‡½æ•°åŠå…¶åº”ç”¨åœºæ™¯ã€‚</p>
<section id="å‡æ–¹è¯¯å·®mse" class="level4">
<h4 class="anchored" data-anchor-id="å‡æ–¹è¯¯å·®mse">å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰</h4>
<p>å‡æ–¹è¯¯å·®ï¼ˆMean Squared Errorï¼ŒMSEï¼‰æ˜¯å›å½’ä»»åŠ¡ä¸­æœ€å¸¸ç”¨çš„æŸå¤±å‡½æ•°ä¹‹ä¸€ï¼Œå®ƒè¡¡é‡æ¨¡å‹é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚ã€‚MSEçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AMSE%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y_i%20-%20%5Chat%7By%7D_i)%5E2%0A"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒMSEæ˜¯é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´å·®å€¼çš„å¹³æ–¹å’Œçš„å‡å€¼ï¼Œå®ƒå¯¹è¾ƒå¤§å·®å¼‚åˆ†é…æ›´é«˜çš„æƒ©ç½šã€‚MSEéè´Ÿï¼Œè¶Šå°ï¼Œè¯´æ˜æ¨¡å‹çš„é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚è¶Šå°ï¼Œæ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›è¶Šå¥½ã€‚MSEå¯¹å¼‚å¸¸å€¼æ•æ„Ÿï¼Œå› ä¸ºå®ƒæ˜¯å·®å€¼çš„å¹³æ–¹å’Œï¼Œå¼‚å¸¸å€¼çš„å¹³æ–¹ä¼šæ”¾å¤§å·®å¼‚ï¼Œå¯¼è‡´æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ä¸‹é™ã€‚</p>
<p>å…¶åœ¨pytorchä¸­çš„å®ç°ï¼š</p>
<div id="mse" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">torch.nn.MSELoss(reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>)</span></code></pre></div>
</div>
</section>
<section id="å¹³å‡ç»å¯¹è¯¯å·®mae" class="level4">
<h4 class="anchored" data-anchor-id="å¹³å‡ç»å¯¹è¯¯å·®mae">å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰</h4>
<p>å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMean Absolute Errorï¼ŒMAEï¼‰æ˜¯å›å½’ä»»åŠ¡ä¸­å¦ä¸€ç§å¸¸ç”¨çš„æŸå¤±å‡½æ•°ã€‚MAEçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AMAE%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%7Cy_i%20-%20%5Chat%7By%7D_i%7C%0A"></p>
<p>ç›¸æ¯”äºMSEï¼ŒMAEæ˜¯é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´å·®å€¼çš„ç»å¯¹å€¼çš„å‡å€¼ï¼Œå®ƒå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼Œå› ä¸ºå®ƒæ˜¯å·®å€¼çš„ç»å¯¹å€¼çš„å’Œï¼Œä¸ä¼šå¯¹æŸä¸€å¼‚å¸¸å€¼çš„å·®å¼‚åˆ†é…è¿‡é«˜çš„æƒé‡ã€‚MAEçš„å€¼è¶Šå°ï¼Œè¯´æ˜æ¨¡å‹çš„é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚è¶Šå°ï¼Œæ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›è¶Šå¥½ã€‚</p>
<p>é’ˆå¯¹MAEå’ŒMSEçš„ä¼˜ç¼ºç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„ä»»åŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æŸå¤±å‡½æ•°ã€‚å¦‚æœä»»åŠ¡éœ€è¦é‡ç‚¹å…³æ³¨å¼‚å¸¸å€¼ï¼Œå¯ä»¥é€‰æ‹©MSEï¼Œå¦åˆ™é€‰æ‹©MAEã€‚</p>
<div id="mae" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">torch.nn.L1Loss(reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>)</span></code></pre></div>
</div>
</section>
<section id="huber-loss" class="level4">
<h4 class="anchored" data-anchor-id="huber-loss">Huber loss</h4>
<p>Huber lossæ˜¯ä¸€ç§ç»“åˆäº†MSEå’ŒMAEçš„æŸå¤±å‡½æ•°ï¼Œå®ƒåœ¨å·®å€¼è¾ƒå°çš„æƒ…å†µä¸‹ä½¿ç”¨MSEï¼Œå·®å€¼è¾ƒå¤§çš„æƒ…å†µä¸‹ä½¿ç”¨MAEã€‚Huber lossçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL_%7B%5Cdelta%7D(y,%20%5Chat%7By%7D)%20=%20%5Cleft%5C%7B%0A%5Cbegin%7Barray%7D%7Bll%7D%0A%5Cfrac%7B1%7D%7B2%7D(y%20-%20%5Chat%7By%7D)%5E2,%20&amp;%20%5Ctext%7Bif%20%7D%20%7Cy%20-%20%5Chat%7By%7D%7C%20%5Cleq%20%5Cdelta%20%5C%5C%0A%5Cdelta%20%7Cy%20-%20%5Chat%7By%7D%7C%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Cdelta%5E2,%20&amp;%20%5Ctext%7Botherwise%7D%0A%5Cend%7Barray%7D%0A%5Cright.%0A"></p>
<p>å…¶ä¸­ï¼Œ<img src="https://latex.codecogs.com/png.latex?%5Cdelta">æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œç”¨äºæ§åˆ¶MSEå’ŒMAEä¹‹é—´çš„å¹³è¡¡ã€‚Huber losså¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼ŒåŒæ—¶ä¿ç•™äº†MSEçš„å¹³æ»‘æ€§ï¼Œæ˜¯ä¸€ç§è¾ƒä¸ºç¨³å¥çš„æŸå¤±å‡½æ•°ã€‚</p>
<div id="smoothl1loss" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">torch.nn.SmoothL1Loss(reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>)</span></code></pre></div>
</div>
</section>
<section id="äºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°binary-cross-entropy-loss" class="level4">
<h4 class="anchored" data-anchor-id="äºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°binary-cross-entropy-loss">äºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼ˆBinary Cross Entropy Lossï¼‰</h4>
<p>äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼ˆCross Entropy Lossï¼‰æ˜¯äºŒåˆ†ç±»ä»»åŠ¡ä¸­æœ€å¸¸ç”¨çš„æŸå¤±å‡½æ•°ä¹‹ä¸€ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿä»¥åŠ<a href="https://mp.weixin.qq.com/s/y2gZKXebDv3tKha7Hu5Djw">ä»‹ç»è¿‡</a>ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(y,%20%5Chat%7By%7D)%20=%20-%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_i%20%5Clog(%5Chat%7By%7D_i)%20+%20(1%20-%20y_i)%20%5Clog(1%20-%20%5Chat%7By%7D_i)%0A"></p>
<p>å…¶ä¸­ï¼Œ<img src="https://latex.codecogs.com/png.latex?y_i">æ˜¯çœŸå®æ ‡ç­¾ï¼Œ<img src="https://latex.codecogs.com/png.latex?%5Chat%7By%7D_i">æ˜¯æ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡å€¼ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°å¯¹äºæ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡å€¼å’ŒçœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚è¿›è¡Œäº†æƒ©ç½šï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ å…³æ³¨é¢„æµ‹æ­£ç¡®çš„ç±»åˆ«ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°æ˜¯ä¸€ç§å‡¸å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡æ¢¯åº¦ä¸‹é™ç­‰æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚</p>
<div id="bce" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">torch.nn.BCELoss(weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>)</span></code></pre></div>
</div>
</section>
<section id="å¤šç±»äº¤å‰ç†µæŸå¤±å‡½æ•°categorical-cross-entropy-loss" class="level4">
<h4 class="anchored" data-anchor-id="å¤šç±»äº¤å‰ç†µæŸå¤±å‡½æ•°categorical-cross-entropy-loss">å¤šç±»äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼ˆCategorical Cross Entropy Lossï¼‰</h4>
<p>å¤šç±»äº¤å‰ç†µæŸå¤±å‡½æ•°æ˜¯å¤šåˆ†ç±»ä»»åŠ¡ä¸­å¸¸ç”¨çš„æŸå¤±å‡½æ•°ä¹‹ä¸€ï¼Œå®ƒæ˜¯äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ‰©å±•ã€‚å¤šç±»äº¤å‰ç†µæŸå¤±å‡½æ•°çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(y,%20%5Chat%7By%7D)%20=%20-%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Csum_%7Bj=1%7D%5E%7Bm%7D%20y_%7Bij%7D%20%5Clog(%5Chat%7By%7D_%7Bij%7D)%0A"></p>
<p>å…¶ä¸­ï¼Œ<img src="https://latex.codecogs.com/png.latex?y_%7Bij%7D">æ˜¯çœŸå®æ ‡ç­¾ï¼Œ<img src="https://latex.codecogs.com/png.latex?%5Chat%7By%7D_%7Bij%7D">æ˜¯æ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡å€¼ã€‚</p>
<div id="ce" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">torch.nn.CrossEntropyLoss(weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>)</span></code></pre></div>
</div>
</section>
<section id="hingeæŸå¤±å‡½æ•°" class="level4">
<h4 class="anchored" data-anchor-id="hingeæŸå¤±å‡½æ•°">HingeæŸå¤±å‡½æ•°</h4>
<p>HingeæŸå¤±å‡½æ•°æ˜¯æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰ä¸­å¸¸ç”¨çš„æŸå¤±å‡½æ•°ä¹‹ä¸€ï¼Œå®ƒé€‚ç”¨äºäºŒåˆ†ç±»ä»»åŠ¡ã€‚HingeæŸå¤±å‡½æ•°çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(y,%20%5Chat%7By%7D)%20=%20%5Cmax(0,%201%20-%20y%20%5Ccdot%20%5Chat%7By%7D)%0A"></p>
<p>HingeæŸå¤±å‡½æ•°æ—¨åœ¨æœ€å¤§åŒ–å†³ç­–è¾¹ç•Œçš„é—´éš”ï¼Œå³ä½¿å¾—æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬è·ç¦»å†³ç­–è¾¹ç•Œçš„è·ç¦»å°½å¯èƒ½å¤§ã€‚HingeæŸå¤±å‡½æ•°å¯¹äºè¯¯åˆ†ç±»çš„æ ·æœ¬è¿›è¡Œäº†æƒ©ç½šï¼Œä½¿å¾—æ¨¡å‹æ›´åŠ å…³æ³¨åˆ†ç±»è¾¹ç•Œé™„è¿‘çš„æ ·æœ¬ï¼Œä»è€Œå°½å¯èƒ½æŠŠæ•°æ®ç‚¹æ¨å‘è¿œç¦»å†³ç­–è¾¹ç•Œçš„æ–¹å‘ã€‚</p>
<p>ä»£ç å·²ç»æ”¾è¿›äº†<a href="https://mp.weixin.qq.com/s/4IR-KMAZ-q2VbI0Fz4fYRg">æ˜Ÿçƒ</a>é‡Œã€‚</p>
<section id="did-you-find-this-page-helpful-consider-sharing-it" class="level5">
<h5 class="anchored" data-anchor-id="did-you-find-this-page-helpful-consider-sharing-it">Did you find this page helpful? Consider sharing it ğŸ™Œ</h5>


<!-- -->

</section>
</section>
</section>

 ]]></description>
  <category>python</category>
  <category>machine learning</category>
  <category>deep learning</category>
  <category>loss function</category>
  <guid>https://leslie-lu.github.io/blog/2024/06/07/loss_function/</guid>
  <pubDate>Fri, 07 Jun 2024 00:00:00 GMT</pubDate>
  <media:content url="https://cdn.jsdelivr.net/gh/Leslie-Lu/WeChatOfficialAccount/img/202406072019199.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Pythonä¸­æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ ¡å‡†</title>
  <dc:creator>Zhen Lu</dc:creator>
  <link>https://leslie-lu.github.io/blog/2024/05/17/calibration/</link>
  <description><![CDATA[ 





<section id="calibration" class="level3">
<h3 class="anchored" data-anchor-id="calibration">calibration</h3>
<p>åœ¨æˆ‘ä»¬åˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹æ¥å»ºæ¨¡åˆ†ç±»é¢„æµ‹æ—¶ï¼Œé¦–è¦å…³æ³¨çš„æŒ‡æ ‡èƒ½åŠ›å½“ç„¶æ˜¯dircriminationï¼Œå³æ¨¡å‹çš„é¢„æµ‹åŒºåˆ†èƒ½åŠ›ã€‚å¸¸è§çš„æŒ‡æ ‡æœ‰sensitivityã€specificityã€AUROCç­‰ã€‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡<a href="https://mp.weixin.qq.com/s/wolSW-kdUU8IC293KR9gKg">æ–‡ç« </a>ä¸­ä»‹ç»äº†å¦‚ä½•é€‰æ‹©æœ€ä¼˜åˆ†ç±»é˜ˆå€¼ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç€ä»‹ç»åœ¨é€‰æ‹©äº†æœ€ä¼˜é˜ˆå€¼åï¼Œå¦‚ä½•è¯„ä¼°æ¨¡å‹çš„<a href="https://mp.weixin.qq.com/s/OdSDu3XXXTbTz_-lYirs5w">æ ¡å‡†èƒ½åŠ›</a>ã€‚</p>
<p>æ‰€è°“æ ¡å‡†èƒ½åŠ›ï¼Œå³æ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡ä¸å®é™…å‘ç”Ÿçš„æ¦‚ç‡<strong>ä¸€è‡´</strong>ã€‚</p>
<p>é€šä¿—æ¥è§£é‡Šè¿™ä¸ªäº‹æƒ…ï¼šæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ¨¡å‹é¢„æµ‹æŸä¸ªç—…äººæ‚£ç—…çš„æ¦‚ç‡æ˜¯0.8ï¼Œé‚£ä¹ˆï¼ŒæŒ‰ç…§æ¦‚ç‡å®šä¹‰ç†è§£ï¼Œæ¨¡å‹é¢„æµ‹æ¦‚ç‡ä¸º0.8æ—¶ï¼Œ100ä¸ªäººä¸­åº”è¯¥æœ‰80ä¸ªäººæœ€ç»ˆæ‚£ç—…ï¼Œè¿™ä¸ªç»“æœä½“ç°äº†æ¨¡å‹çš„æ ¡å‡†èƒ½åŠ›å’Œç¨³å®šæ€§ã€‚å¦‚æœæ¨¡å‹é¢„æµ‹æ¦‚ç‡ä¸º0.8æ—¶ï¼Œå®é™…åªæœ‰20ä¸ªäººæ‚£ç—…ï¼Œé‚£ä¹ˆï¼Œæ¨¡å‹çš„æ ¡å‡†èƒ½åŠ›å°±ä¸å¤Ÿå¥½ï¼Œä½ ä¹Ÿä¸ä¼šä¿¡ä»»è¿™ä¸ªæ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„é¢„æµ‹ç»“æœã€‚è¿™å°±æ˜¯æ ¡å‡†èƒ½åŠ›çš„é‡è¦æ€§ï¼Œå³ä½ çš„æ¨¡å‹æœ€ç»ˆè¾“å‡ºçš„æ¦‚ç‡å€¼è¦å‡†ç¡®åæ˜ å‡ºäº‹ä»¶å®é™…å‘ç”Ÿçš„æ¦‚ç‡ã€‚</p>
</section>
<section id="å¦‚ä½•è¯„ä»·calibration" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="å¦‚ä½•è¯„ä»·calibration">å¦‚ä½•è¯„ä»·calibration</h3>
<section id="calibration-plot" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="calibration-plot">calibration plot</h4>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://cdn.jsdelivr.net/gh/Leslie-Lu/WeChatOfficialAccount/img/202405171632445.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">calibration curve</figcaption>
</figure>
</div>
<p>ä¸Šå›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„calibration curveï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æ–‡ç« ä¸­å¸¸è§çš„å›¾ã€‚</p>
<p>æˆ‘ä»¬å°†æ¨¡å‹é¢„æµ‹æ¦‚ç‡cutæˆ–è€…quantileæˆ5æˆ–è€…10ä¸ªåŒºé—´ï¼ˆbinï¼‰ï¼Œæ¯ä¸ªåŒºé—´é¢„æµ‹æ¦‚ç‡çš„å‡å€¼ä½œä¸ºxè½´ï¼Œæ¯ä¸ªåŒºé—´å®é™…å‘ç”Ÿçš„æ¦‚ç‡ä½œä¸ºyè½´ï¼Œç„¶åç”»å‡ºæ¥è¿™ä¸ªæ›²çº¿ã€‚è¿™ä¸ªå›¾æ˜¯è¯„ä»·æ¨¡å‹æ ¡å‡†èƒ½åŠ›çš„ä¸€ä¸ªç›´è§‚æŒ‡æ ‡ã€‚pythonä¸­å¯ä»¥è½»æ¾å®ç°è¿™ä¸ªå·¥ä½œï¼š</p>
<div id="calibration--plot" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.calibration <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> calibration_curve</span>
<span id="cb1-2">y_means, pred_means <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calibration_curve(y_true, y_pred, n_bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,strategy)</span></code></pre></div>
</div>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç‚¹éƒ½åœ¨å¯¹è§’çº¿ä¸Šï¼Œå³æ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡ä¸å®é™…å‘ç”Ÿçš„æ¦‚ç‡å®Œå…¨ä¸€è‡´ã€‚å¦‚æœç‚¹åœ¨å¯¹è§’çº¿ä¸Šæ–¹ï¼Œè¯´æ˜æ¨¡å‹ä½ä¼°ï¼Œåä¹‹ï¼Œé«˜ä¼°ã€‚</p>
<p>calibration levelçš„å®šä¹‰æœ‰ï¼š</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://cdn.jsdelivr.net/gh/Leslie-Lu/WeChatOfficialAccount/img/202405171653641.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">calibration level<span class="citation" data-cites="RN410">(Alonzo 2009)</span></figcaption>
</figure>
</div>
</section>
<section id="å…¶ä»–æŒ‡æ ‡" class="level4">
<h4 class="anchored" data-anchor-id="å…¶ä»–æŒ‡æ ‡">å…¶ä»–æŒ‡æ ‡</h4>
<p>é™¤äº†calibration plotï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å…¶ä»–æŒ‡æ ‡æ¥è¯„ä»·æ¨¡å‹çš„æ ¡å‡†èƒ½åŠ›ï¼Œæ¯”å¦‚è¯´Brier scoreã€Hosmer-Lemeshow testã€calibration in the largeç­‰ã€‚è¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»ã€‚</p>
<p>æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯ï¼Œå½“æˆ‘ä»¬é€šè¿‡ä¸Šè¿°æ–¹æ³•è¯„ä»·äº†æ¨¡å‹çš„æ ¡å‡†èƒ½åŠ›åï¼Œå¦‚æœå‘ç°æ¨¡å‹çš„æ ¡å‡†èƒ½åŠ›ä¸å¤Ÿå¥½ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
</section>
</section>
<section id="calibrate-model" class="level3">
<h3 class="anchored" data-anchor-id="calibrate-model">calibrate model</h3>
<p>æˆ‘ä»¬å·²ç»å‘ç°ï¼Œæ¨¡å‹è¾“å‡ºå€¼å¹¶ä¸èƒ½ä»£è¡¨æ¦‚ç‡ã€‚pythonä¸­ä¸€èˆ¬æœ‰<strong>predict_proba</strong>æ–¹æ³•ï¼Œå³è¿™ä¸ªæ–¹æ³•å…¶å®å¹¶ä¸èƒ½ä¿è¯è¾“å‡ºçš„æ¦‚ç‡æ˜¯çœŸå®çš„æ¦‚ç‡ã€‚</p>
<div id="predict_proba" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.ensemble <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RandomForestClassifier</span>
<span id="cb2-2">model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RandomForestClassifier().fit(X_train, y_train)</span>
<span id="cb2-3">y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict_proba(X_test)[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
</div>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œæ ¡å‡†ã€‚</p>
<section id="platt-scaling" class="level4">
<h4 class="anchored" data-anchor-id="platt-scaling">Platt scaling</h4>
<p>Platt scalingæ˜¯ä¸€ç§å¸¸è§çš„æ ¡å‡†æ–¹æ³•ï¼Œå…¶åŸç†æ˜¯å¯¹æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡ä»¥åŠçœŸå®æ ‡ç­¾ï¼Œç”¨ä¸€ä¸ªlogistic regressionæ¨¡å‹æ¥æ‹Ÿåˆï¼Œä»è€Œå®ç°å¯¹æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡è¿›è¡Œæ ¡å‡†ï¼Œæ‹¿åˆ°æœ€ç»ˆçš„æ¦‚ç‡ã€‚</p>
<div id="platt-scaling" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.calibration <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CalibratedClassifierCV</span>
<span id="cb3-2">calibrated <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CalibratedClassifierCV(model, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sigmoid'</span>, cv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb3-3">calibrated.fit(X_train, y_train)</span></code></pre></div>
</div>
</section>
<section id="isotonic-regression" class="level4">
<h4 class="anchored" data-anchor-id="isotonic-regression">Isotonic regression</h4>
<p>Isotonic regressionæ˜¯å¦ä¸€ç§æ ¡å‡†æ–¹æ³•ï¼Œå…¶åŸç†æ˜¯å¯¹æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡ä»¥åŠçœŸå®æ ‡ç­¾ï¼Œç”¨ä¸€ä¸ªisotonic regressionæ¨¡å‹æ¥æ‹Ÿåˆï¼Œä»è€Œå®ç°å¯¹æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡è¿›è¡Œæ ¡å‡†ã€‚</p>
<div id="isotonic-regression" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.isotonic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> IsotonicRegression</span>
<span id="cb4-2">ir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> IsotonicRegression().fit(y_pred, y_test)</span></code></pre></div>
</div>
</section>
<section id="bayesian-binning-into-quantiles" class="level4">
<h4 class="anchored" data-anchor-id="bayesian-binning-into-quantiles">bayesian binning into quantiles</h4>
<p>BBQæ˜¯ä¸€ç§åŸºäºè´å¶æ–¯çš„æ ¡å‡†æ–¹æ³•ï¼Œå…¶åŸç†æ˜¯å°†é¢„æµ‹æ¦‚ç‡åˆ†æˆè‹¥å¹²ä¸ªåŒºé—´ï¼Œç„¶ååœ¨æ¯ä¸ªåŒºé—´å†…å¯¹æ¦‚ç‡è¿›è¡Œæ ¡å‡†ã€‚è¯¥æ–¹æ³•ç»“åˆäº†åˆ†ç®±ï¼ˆbinningï¼‰å’Œè´å¶æ–¯æ¨æ–­çš„ä¼˜ç‚¹ï¼Œå¯ä»¥åœ¨æ ·æœ¬é‡è¾ƒå°æ—¶ä»ç„¶ä¿æŒè¾ƒå¥½çš„æ ¡å‡†æ•ˆæœã€‚</p>
<p>è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥ä¾›å°è¯•ã€‚</p>
</section>
</section>
<section id="take-home-message" class="level3">
<h3 class="anchored" data-anchor-id="take-home-message">take home message</h3>
<p>åœ¨åˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œåˆ†ç±»é¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬ä¸å¯å¿½è§†æ¨¡å‹çš„æ ¡å‡†èƒ½åŠ›ã€‚</p>
<p>ä»£ç å·²ç»æ”¾è¿›äº†<a href="https://mp.weixin.qq.com/s/4IR-KMAZ-q2VbI0Fz4fYRg">æ˜Ÿçƒ</a>é‡Œã€‚</p>
<section id="did-you-find-this-page-helpful-consider-sharing-it" class="level5">
<h5 class="anchored" data-anchor-id="did-you-find-this-page-helpful-consider-sharing-it">Did you find this page helpful? Consider sharing it ğŸ™Œ</h5>
</section>
</section>
<section id="references" class="level3">



<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-RN410" class="csl-entry">
Alonzo, T. A. 2009. <span>â€œClinical Prediction Models: A Practical Approach to Development, Validation, and Updating: By Ewout w. Steyerberg.â€</span> Generic. Oxford University Press.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{lu2024,
  author = {Lu, Zhen},
  title = {Pythonä¸­æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ ¡å‡†},
  date = {2024-05-17},
  url = {https://leslie-lu.github.io//blog/2024/05/17/calibration},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-lu2024" class="csl-entry quarto-appendix-citeas">
Lu, Zhen. 2024. <span>â€œPythonä¸­æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ ¡å‡†.â€</span> May 17, 2024.
<a href="https://leslie-lu.github.io//blog/2024/05/17/calibration">https://leslie-lu.github.io//blog/2024/05/17/calibration</a>.
</div></div></section></div> ]]></description>
  <category>python</category>
  <category>machine learning</category>
  <category>calibration</category>
  <guid>https://leslie-lu.github.io/blog/2024/05/17/calibration/</guid>
  <pubDate>Fri, 17 May 2024 00:00:00 GMT</pubDate>
  <media:content url="https://cdn.jsdelivr.net/gh/Leslie-Lu/WeChatOfficialAccount/img/202405171632445.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Hierarchical composite endpointsæ²»ç–—æ•ˆåº”çš„å¯è§†åŒ–</title>
  <dc:creator>Zhen Lu</dc:creator>
  <link>https://leslie-lu.github.io/blog/2024/05/13/hierarchical_composite_endpoints/</link>
  <description><![CDATA[ 





<section id="å¤åˆç»ˆç‚¹" class="level3">
<h3 class="anchored" data-anchor-id="å¤åˆç»ˆç‚¹">å¤åˆç»ˆç‚¹</h3>
<p>æœ‰æ—¶ï¼Œæ ¹æ®ä¸»è¦ç ”ç©¶ç›®çš„ï¼Œæˆ‘ä»¬å¾ˆéš¾ä»å¤šä¸ªç»ˆç‚¹æŒ‡æ ‡ä¸­é€‰å‡ºå…¶ä¸­æŸä¸€ä¸ªä½œä¸ºä¸»è¦ç»ˆç‚¹ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>å¤åˆç»ˆç‚¹</strong>æ¥ä½œä¸ºä¸»è¦ç»ˆç‚¹ã€‚</p>
<p>Hierarchical composite endpoints (<a href="https://cran.r-project.org/web/packages/hce/hce.pdf">HCE</a>)å¯ä»¥æ•´åˆä¸åŒç±»å‹ã€ä¸åŒé‡è¦æ€§ç»ˆç‚¹æˆä¸€ä¸ªæœ‰åºç»ˆç‚¹æŒ‡æ ‡ï¼Œä»¥è¡¨ç¤ºæ‚£è€…ç»å†çš„ä¸åŒä¸¥é‡ç¨‹åº¦çš„ç»ˆç‚¹ã€‚å¦‚ï¼Œåœ¨å›ºå®šéšè®¿çš„RCTä¸­ï¼Œoutcomes of interestå¯ä»¥æ˜¯deathã€hospitalizationï¼Œè€Œè¿™ä¸¤ä¸ªç»ˆç‚¹å­˜åœ¨ä¸¥é‡ç¨‹åº¦çš„å·®å¼‚ã€‚å¾ˆæ˜æ˜¾ï¼Œæ­»äº¡æ˜¯æœ€ä¸¥é‡çš„ã€‚åŒæ ·æœ€ç»ˆæ­»äº¡çš„ä¸¤ä¸ªæ‚£è€…ï¼Œç”Ÿå­˜æ—¶é—´æ›´é•¿ï¼Œæ„å‘³æ²»ç–—æ•ˆåº”æ›´å¥½ï¼›åŒæ ·æœ€ç»ˆä½é™¢çš„ä¸¤ä¸ªæ‚£è€…ï¼Œå…¥é™¢å‰æ—¶é—´æ›´é•¿ï¼Œæ²»ç–—æ•ˆåº”æ›´å¥½ï¼›åŒæ ·æœªä½é™¢çš„ä¸¤ä¸ªæ‚£è€…ï¼ŒæŸä¸€å®éªŒå®¤æŒ‡æ ‡çš„change from baselineæ›´å¤§ï¼Œæ•ˆåº”æ›´å¥½ã€‚</p>
<p>å¯¹äºè¿™ç§HCEï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—win odds<span class="citation" data-cites="RN1185">(Gasparyan et al. 2021)</span>æ¥æ¯”è¾ƒç»„é—´å·®å¼‚ï¼Œç„¶è€Œï¼Œæ²»ç–—æ•ˆåº”çš„å¯è§†åŒ–å—åˆ°å¤åˆç»ˆç‚¹çš„å½±å“ï¼Œä¸å®¹æ˜“åƒå•çº¯çš„ç”Ÿå­˜æ›²çº¿é‚£æ ·ç”¨åˆé€‚çš„å·¥å…·å¯è§†åŒ–å‡ºæ¥ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼ŒAstraZenecaçš„Martin Karpeforsç­‰äººæå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ³•ï¼Œå³<em>maraca plot<span class="citation" data-cites="RN1187">(Karpefors, Lindholm, and Gasparyan 2023)</span></em>ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å°†å¤åˆç»ˆç‚¹ä¸­time to event(TTE)ä»¥åŠè¿ç»­æ€§ç»ˆç‚¹çš„æ²»ç–—æ•ˆåº”å¯è§†åŒ–å‡ºæ¥ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥æ¯”è¾ƒä¸åŒæ²»ç–—ç»„ä¹‹é—´çš„å·®å¼‚ã€‚å¯¹åº”çš„<a href="https://cran.r-project.org/web/packages/maraca/index.html">RåŒ…</a>å¯ä»¥æ–¹ä¾¿åœ°å®ç°è¿™ä¸€ç‚¹ã€‚</p>
</section>
<section id="maraca-plot" class="level3">
<h3 class="anchored" data-anchor-id="maraca-plot">maraca plot</h3>
<p>maracaåŸºäºggplot2ï¼Œå…¶ä¸­ï¼Œå¯¹äºTTEé‡‡ç”¨Kaplan-Meieræ›²çº¿å±•ç¤ºcumulative proportionsï¼Œå¯¹äºè¿ç»­æ€§ç»ˆç‚¹å¯é€‰ç”¨ç®±çº¿å›¾ã€violin plotä»¥åŠscatter plotå±•ç¤ºè¿ç»­æ€§åˆ†å¸ƒã€‚è¿™ç§æ–¹æ³•å¯ä»¥åŒæ—¶å±•ç¤ºHCEçš„ä¸åŒç»„æˆæˆåˆ†ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(maraca)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(hce_scenario_a, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maraca"</span>)</span>
<span id="cb1-3">data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hce_scenario_a</span>
<span id="cb1-4">data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  SUBJID              GROUP GROUPN      AVAL0       AVAL    TRTP
1      1          Outcome I      0 120.440921   120.4409  Active
2      2 Continuous outcome  40000   3.345229 40003.3452 Control
3      3 Continuous outcome  40000  22.802615 40022.8026  Active
4      4          Outcome I      0 577.311386   577.3114 Control
5      5         Outcome II  10000 781.758081 10781.7581  Active
6      6        Outcome III  20000 985.097981 20985.0980 Control</code></pre>
</div>
</div>
<p>å…·ä½“å˜é‡æ„ä¹‰ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹<code>?hce_scenario_a</code>ã€‚</p>
<p>å¯è§†åŒ–å¦‚ä¸‹ï¼š</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">column_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">outcome =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GROUP"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arm =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRTP"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AVAL0"</span>)</span>
<span id="cb3-2">tte_outcomes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome I"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome II"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome III"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome IV"</span>)</span>
<span id="cb3-3">continuous_outcome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Continuous outcome"</span></span>
<span id="cb3-4">arm_levels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">active =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Active"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Control"</span>)</span>
<span id="cb3-5">maraca_object <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">maraca</span>(</span>
<span id="cb3-6">  data, tte_outcomes, continuous_outcome, arm_levels, column_names,</span>
<span id="cb3-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fixed_followup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">compute_win_odds =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb3-8">)</span>
<span id="cb3-9">AZ_colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#830051"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F0AB00"</span>)</span>
<span id="cb3-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(maraca_object, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">density_plot_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> AZ_colors) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> AZ_colors)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://leslie-lu.github.io/blog/2024/05/13/hierarchical_composite_endpoints/index_files/figure-html/maraca-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ç»“æœè§£é‡Š" class="level3">
<h3 class="anchored" data-anchor-id="ç»“æœè§£é‡Š">ç»“æœè§£é‡Š</h3>
<p>æ€ä¹ˆçœ‹è¿™å¼ å›¾ï¼Ÿ</p>
<p>é¦–å…ˆæ˜¯xè½´ä¸ŠHCEçš„5ä¸ªç»„æˆæˆåˆ†ï¼Œxè½´ä¸Šæ¯ä¸ªæˆåˆ†çš„é•¿åº¦å¤§å°ï¼Œä»£è¡¨äº†æ‚£è€…è¾¾åˆ°ä¸åŒæˆåˆ†ç»ˆç‚¹çš„æ¯”ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œcontinuous outcomeçš„æ¯”ä¾‹æœ€å¤§ï¼Œè¯´æ˜è¿™ä¸ªç»ˆç‚¹çš„æ‚£è€…æ‰€å æ¯”ä¾‹æœ€å¤§ã€‚å…¶æ¬¡ï¼Œcumulative percentageæ˜¾ç¤ºactiveç»„åœ¨å››ä¸ªTTEç»ˆç‚¹ä¸Šæ˜¯å­˜åœ¨å·®å¼‚çš„ã€‚å†ç„¶åæ˜¯continuous outcomeçš„åˆ†å¸ƒï¼Œåå‘xè½´å³ä¾§ä»£è¡¨change from baselineæ›´å¤§ã€‚è€Œè¿™äº›ç»“åˆèµ·æ¥ï¼Œå°±æ˜¯win oddsçš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå’Œæˆ‘ä»¬ä»å¯è§†åŒ–çš„è§’åº¦çœ‹åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ä»£ç å·²ç»æ”¾è¿›äº†<a href="https://mp.weixin.qq.com/s/4IR-KMAZ-q2VbI0Fz4fYRg">æ˜Ÿçƒ</a>é‡Œã€‚</p>
<section id="did-you-find-this-page-helpful-consider-sharing-it" class="level5">



<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Did you find this page helpful? Consider sharing it ğŸ™Œ</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-RN1185" class="csl-entry">
Gasparyan, S. B., E. K. Kowalewski, F. Folkvaljon, O. Bengtsson, J. Buenconsejo, J. Adler, and G. G. Koch. 2021. <span>â€œPower and Sample Size Calculation for the Win Odds Test: Application to an Ordinal Endpoint in COVID-19 Trials.â€</span> Journal Article. <em>Journal of Biopharmaceutical Statistics</em> 31 (6): 765â€“87.
</div>
<div id="ref-RN1187" class="csl-entry">
Karpefors, M., D. Lindholm, and S. B. Gasparyan. 2023. <span>â€œThe Maraca Plot: A Novel Visualization of Hierarchical Composite Endpoints.â€</span> Journal Article. <em>Clinical Trials (London, England)</em> 20 (1): 84â€“88. <a href="https://doi.org/10.1177/17407745221134949">https://doi.org/10.1177/17407745221134949</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{lu2024,
  author = {Lu, Zhen},
  title = {Hierarchical Composite {endpointsæ²»ç–—æ•ˆåº”çš„å¯è§†åŒ–}},
  date = {2024-05-13},
  url = {https://leslie-lu.github.io//blog/2024/05/13/hierarchical_composite_endpoints},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-lu2024" class="csl-entry quarto-appendix-citeas">
Lu, Zhen. 2024. <span>â€œHierarchical Composite
Endpointsæ²»ç–—æ•ˆåº”çš„å¯è§†åŒ–.â€</span> May 13, 2024. <a href="https://leslie-lu.github.io//blog/2024/05/13/hierarchical_composite_endpoints">https://leslie-lu.github.io//blog/2024/05/13/hierarchical_composite_endpoints</a>.
</div></div></section></div> ]]></description>
  <category>r</category>
  <category>clinical trial</category>
  <category>endpoint</category>
  <guid>https://leslie-lu.github.io/blog/2024/05/13/hierarchical_composite_endpoints/</guid>
  <pubDate>Mon, 13 May 2024 00:00:00 GMT</pubDate>
  <media:content url="https://cdn.jsdelivr.net/gh/Leslie-Lu/WeChatOfficialAccount/img/202405131659328.png" medium="image" type="image/png"/>
</item>
<item>
  <title>æœ€ä¼˜åˆ†ç±»é˜ˆå€¼</title>
  <dc:creator>Zhen Lu</dc:creator>
  <link>https://leslie-lu.github.io/blog/2024/05/11/optimal_threshold/</link>
  <description><![CDATA[ 





<p>è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©<em>scikit-learn</em>æ¥æ¢è®¨åˆ†ç±»é—®é¢˜ä¸­é˜ˆå€¼çš„é€‰æ‹©ã€‚</p>
<section id="æ•°æ®å‡†å¤‡å’Œå‚æ•°é€‰æ‹©" class="level3">
<h3 class="anchored" data-anchor-id="æ•°æ®å‡†å¤‡å’Œå‚æ•°é€‰æ‹©">æ•°æ®å‡†å¤‡å’Œå‚æ•°é€‰æ‹©</h3>
<p>é¦–å…ˆæ˜¯æ•°æ®å‡†å¤‡ï¼š</p>
<div id="libraries-n-things" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_breast_cancer</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> train_test_split</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> confusion_matrix</span>
<span id="cb1-8"></span>
<span id="cb1-9">np.set_printoptions(suppress<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, precision<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb1-10">pd.options.mode.chained_assignment <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-11">pd.set_option(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'display.max_columns'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb1-12">pd.set_option(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'display.width'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb1-13"></span>
<span id="cb1-14">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_breast_cancer()</span>
<span id="cb1-15">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>]</span>
<span id="cb1-16">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span>]</span>
<span id="cb1-17"></span>
<span id="cb1-18">Xtrain, Xvalid, ytrain, yvalid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(X, y, test_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.20</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Xtrain.shape: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Xtrain<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>shape<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Xvalid.shape: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Xvalid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>shape<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Xtrain.shape: (455, 30)
Xvalid.shape: (114, 30)</code></pre>
</div>
</div>
<p>æ¨¡å‹æˆ‘ä»¬è¿™é‡Œé€‰æ‹©<em>éšæœºæ£®æ—</em>ã€‚è¶…å‚çš„é€‰æ‹©ï¼ŒåŸºäº<code>GridSearchCV</code>ï¼Œè¿™é‡Œä¹Ÿä¸èµ˜è¿°ã€‚æœ‰ä¸€ä¸ªç‚¹éœ€è¦è¯´æ˜ï¼Œç”±äºä½¿ç”¨çš„æ˜¯è‚¿ç˜¤æ•°æ®é›†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ›´å…³æ³¨çš„æ˜¯<code>recall</code>ï¼Œå³å°½é‡å‡å°‘å‡é˜´æ€§çš„æƒ…å†µã€‚å› è€Œï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œä¹Ÿæ˜¯å°†recallä½œä¸ºè¯„ä»·æŒ‡æ ‡ã€‚</p>
<div id="train-model-rf" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.ensemble <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RandomForestClassifier</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GridSearchCV</span>
<span id="cb3-3"></span>
<span id="cb3-4">param_grid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_estimators"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>],</span>
<span id="cb3-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"min_samples_leaf"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>],</span>
<span id="cb3-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ccp_alpha"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.3</span>]</span>
<span id="cb3-8">    }</span>
<span id="cb3-9"></span>
<span id="cb3-10">mdl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GridSearchCV(</span>
<span id="cb3-11">    RandomForestClassifier(random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>), </span>
<span id="cb3-12">    param_grid, </span>
<span id="cb3-13">    scoring<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recall"</span>, </span>
<span id="cb3-14">    cv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb3-15">    )</span>
<span id="cb3-16"></span>
<span id="cb3-17">mdl.fit(Xtrain, ytrain)</span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"best parameters: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mdl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>best_params_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>best parameters: {'ccp_alpha': 0, 'min_samples_leaf': 4, 'n_estimators': 100}</code></pre>
</div>
</div>
</section>
<section id="æ¨¡å‹é¢„æµ‹" class="level3">
<h3 class="anchored" data-anchor-id="æ¨¡å‹é¢„æµ‹">æ¨¡å‹é¢„æµ‹</h3>
<p>æ‹¿åˆ°æ¨¡å‹åï¼Œè‡ªç„¶æˆ‘ä»¬å¯ä»¥å¼€å§‹é¢„æµ‹ï¼š</p>
<div id="cell-predict" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">ypred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mdl.predict_proba(Xvalid)[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb5-2">ypred</span></code></pre></div>
<div id="predict" class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([0.005     , 0.82743637, 0.97088095, 0.        , 0.        , 1.        , 0.98020202, 0.67380556, 0.        , 0.99333333, 0.9975    , 0.30048576, 0.9528113 , 0.99666667, 0.04102381, 0.99444444, 1.        , 0.828226  , 0.        , 0.        , 0.97916667, 1.        , 0.99607143, 0.90425163, 0.        , 0.02844156, 0.99333333, 0.98183333, 0.9975    , 0.08869769, 0.97369841, 0.        , 1.        , 0.71100866, 0.96022727, 0.        , 0.71200885, 0.06103175, 0.005     , 0.99490476, 0.1644127 , 0.        , 0.23646934, 1.        , 0.57680164, 0.64901715, 0.9975    , 0.61790818, 0.95509668, 0.99383333, 0.04570455, 0.97575758, 1.        , 0.47115815, 0.92422619, 0.77371415, 0.        , 1.        , 0.26198657, 0.        , 0.28206638, 0.95216162, 0.98761905, 0.99464286, 0.98704762, 0.85579351, 0.10036905, 0.00222222, 0.98011905, 0.99857143, 0.92285967, 0.95180556, 0.97546947, 0.84433189, 0.005     , 0.99833333, 0.83616339, 1.        , 0.9955    , 1.        , 0.99833333, 1.        ,
       0.86399315, 0.9807381 , 0.        , 0.99833333, 0.9975    , 0.        , 0.98733333, 0.96822727, 0.23980827, 0.7914127 , 0.        , 0.98133333, 1.        , 1.        , 0.89251019, 0.9498226 , 0.18943254, 0.83494391, 0.9975    , 1.        , 0.77079113, 0.99722222, 0.30208297, 1.        , 0.92111977, 0.99428571, 0.91936508, 0.47118074, 0.98467172, 0.006     , 0.05750305, 0.96954978])</code></pre>
</div>
</div>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬è¦è®²çš„ä¸œè¥¿å°±æ¥äº†ã€‚ä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©0.50ä½œä¸ºåˆ†ç±»é˜ˆå€¼ï¼Œå³å¤§äº0.50çš„ä¸ºæ­£ç±»ï¼Œå°äº0.50çš„ä¸ºè´Ÿç±»ã€‚</p>
<div id="threshold-0.50" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">ypred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mdl.predict_proba(Xvalid)[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-2">yhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mdl.predict(Xvalid).reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-3">preds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.concatenate([ypred, yhat], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(preds)</span>
<span id="cb7-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(confusion_matrix(yvalid, yhat))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0.005      0.        ]
 [0.82743637 1.        ]
 [0.97088095 1.        ]
 [0.         0.        ]
 [0.         0.        ]
 [1.         1.        ]
 [0.98020202 1.        ]
 [0.67380556 1.        ]
 [0.         0.        ]
 [0.99333333 1.        ]
 [0.9975     1.        ]
 [0.30048576 0.        ]
 [0.9528113  1.        ]
 [0.99666667 1.        ]
 [0.04102381 0.        ]
 [0.99444444 1.        ]
 [1.         1.        ]
 [0.828226   1.        ]
 [0.         0.        ]
 [0.         0.        ]
 [0.97916667 1.        ]
 [1.         1.        ]
 [0.99607143 1.        ]
 [0.90425163 1.        ]
 [0.         0.        ]
 [0.02844156 0.        ]
 [0.99333333 1.        ]
 [0.98183333 1.        ]
 [0.9975     1.        ]
 [0.08869769 0.        ]
 [0.97369841 1.        ]
 [0.         0.        ]
 [1.         1.        ]
 [0.71100866 1.        ]
 [0.96022727 1.        ]
 [0.         0.        ]
 [0.71200885 1.        ]
 [0.06103175 0.        ]
 [0.005      0.        ]
 [0.99490476 1.        ]
 [0.1644127  0.        ]
 [0.         0.        ]
 [0.23646934 0.        ]
 [1.         1.        ]
 [0.57680164 1.        ]
 [0.64901715 1.        ]
 [0.9975     1.        ]
 [0.61790818 1.        ]
 [0.95509668 1.        ]
 [0.99383333 1.        ]
 [0.04570455 0.        ]
 [0.97575758 1.        ]
 [1.         1.        ]
 [0.47115815 0.        ]
 [0.92422619 1.        ]
 [0.77371415 1.        ]
 [0.         0.        ]
 [1.         1.        ]
 [0.26198657 0.        ]
 [0.         0.        ]
 [0.28206638 0.        ]
 [0.95216162 1.        ]
 [0.98761905 1.        ]
 [0.99464286 1.        ]
 [0.98704762 1.        ]
 [0.85579351 1.        ]
 [0.10036905 0.        ]
 [0.00222222 0.        ]
 [0.98011905 1.        ]
 [0.99857143 1.        ]
 [0.92285967 1.        ]
 [0.95180556 1.        ]
 [0.97546947 1.        ]
 [0.84433189 1.        ]
 [0.005      0.        ]
 [0.99833333 1.        ]
 [0.83616339 1.        ]
 [1.         1.        ]
 [0.9955     1.        ]
 [1.         1.        ]
 [0.99833333 1.        ]
 [1.         1.        ]
 [0.86399315 1.        ]
 [0.9807381  1.        ]
 [0.         0.        ]
 [0.99833333 1.        ]
 [0.9975     1.        ]
 [0.         0.        ]
 [0.98733333 1.        ]
 [0.96822727 1.        ]
 [0.23980827 0.        ]
 [0.7914127  1.        ]
 [0.         0.        ]
 [0.98133333 1.        ]
 [1.         1.        ]
 [1.         1.        ]
 [0.89251019 1.        ]
 [0.9498226  1.        ]
 [0.18943254 0.        ]
 [0.83494391 1.        ]
 [0.9975     1.        ]
 [1.         1.        ]
 [0.77079113 1.        ]
 [0.99722222 1.        ]
 [0.30208297 0.        ]
 [1.         1.        ]
 [0.92111977 1.        ]
 [0.99428571 1.        ]
 [0.91936508 1.        ]
 [0.47118074 0.        ]
 [0.98467172 1.        ]
 [0.006      0.        ]
 [0.05750305 0.        ]
 [0.96954978 1.        ]]
[[35  3]
 [ 1 75]]</code></pre>
</div>
</div>
<p>ä½†æ˜¯ï¼Œè¿™ä¸ªé˜ˆå€¼æ˜¯å¯ä»¥è°ƒæ•´çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´é˜ˆå€¼æ¥è¾¾åˆ°ä¸åŒçš„ç›®çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´é˜ˆå€¼æ¥å‡å°‘å‡é˜´æ€§çš„æƒ…å†µï¼Œè¿™åœ¨ç±»åˆ«ä¸å¹³è¡¡æ—¶å°¤ä¸ºé‡è¦ã€‚</p>
</section>
<section id="é˜ˆå€¼çš„é€‰æ‹©" class="level3">
<h3 class="anchored" data-anchor-id="é˜ˆå€¼çš„é€‰æ‹©">é˜ˆå€¼çš„é€‰æ‹©</h3>
<p>æˆ‘ä»¬ä»‹ç»å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<section id="é˜³æ€§ç±»åˆ«prevalance" class="level4">
<h4 class="anchored" data-anchor-id="é˜³æ€§ç±»åˆ«prevalance">1. é˜³æ€§ç±»åˆ«prevalance</h4>
<p>æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªæ•°æ®é›†ä¸­é˜³æ€§ç±»åˆ«çš„æ¯”ä¾‹ï¼š</p>
<div id="positive-prevalance" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Proportion of positives in training set: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ytrain<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ytrain<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Proportion of positives in training set: 0.62</code></pre>
</div>
</div>
<p>è¿™ä¸ªtoyæ•°æ®é›†å¾ˆå¤¸å¼ å“ˆï¼Œè¾¾åˆ°äº†0.62ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸ªæ¯”ä¾‹å¯èƒ½åªæœ‰10%æˆ–è€…1%ã€‚è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ‹¿å®ƒç¤ºä¾‹å“ˆï¼Œç”¨è¿™ä¸ªprevalanceæ¥ä½œä¸ºé˜ˆå€¼ã€‚</p>
<div id="threshold-prevalance" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">thresh <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ytrain.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ytrain.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb11-2">yhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(ypred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> thresh, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(confusion_matrix(yvalid, yhat))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[34  4]
 [ 0 76]]</code></pre>
</div>
</div>
<p>è€ƒè™‘prevalanceçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ç±»åˆ«ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œå‡å°‘å‡é˜´æ€§çš„æƒ…å†µã€‚</p>
</section>
<section id="æœ€ä¼˜f1æŒ‡æ•°" class="level4">
<h4 class="anchored" data-anchor-id="æœ€ä¼˜f1æŒ‡æ•°">2. æœ€ä¼˜F1æŒ‡æ•°</h4>
<p>F1æŒ‡æ•°æ˜¯precisionå’Œrecallçš„è°ƒå’Œå¹³å‡æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€å¤§F1æŒ‡æ•°æ¥é€‰æ‹©æœ€ä¼˜çš„é˜ˆå€¼ã€‚</p>
<div id="threshold-f1" class="cell" data-execution_count="7">
<div class="cell-output cell-output-stdout">
<pre><code>Threshold using optimal f1-score: 0.471.</code></pre>
</div>
</div>
<p>F1æœ€é«˜ä¸º0.471ï¼Œæˆ‘ä»¬é‡‡ç”¨å®ƒæ¥è¿›è¡Œé¢„æµ‹ï¼š</p>
<div id="threshold-f1-predict" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">thresh <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.471</span></span>
<span id="cb14-2">yhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(ypred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> thresh, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb14-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(confusion_matrix(yvalid, yhat))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[34  4]
 [ 0 76]]</code></pre>
</div>
</div>
</section>
<section id="rocæ›²çº¿" class="level4">
<h4 class="anchored" data-anchor-id="rocæ›²çº¿">3. ROCæ›²çº¿</h4>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<a href="https://mp.weixin.qq.com/s/Zw85hAdx7VdwCioG5NwHQw">ROCæ›²çº¿</a>æ¥é€‰æ‹©æœ€ä¼˜çš„é˜ˆå€¼ã€‚ROCæ›²çº¿ä¸‹çš„é¢ç§¯AUCè¶Šå¤§ï¼Œè¯´æ˜æ¨¡å‹è¶Šå¥½ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ROCæ›²çº¿æœ€é è¿‘å·¦ä¸Šè§’çš„ç‚¹ä½œä¸ºæœ€ä¼˜é˜ˆå€¼ã€‚</p>
<div id="cell-threshold-roc" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://leslie-lu.github.io/blog/2024/05/11/optimal_threshold/index_files/figure-html/threshold-roc-output-1.png" id="threshold-roc" class="quarto-figure quarto-figure-center anchored figure-img" width="445" height="447"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prcæ›²çº¿" class="level4">
<h4 class="anchored" data-anchor-id="prcæ›²çº¿">4. PRCæ›²çº¿</h4>
<p>PRCæ›²çº¿æ˜¯<a href="https://mp.weixin.qq.com/s/Zw85hAdx7VdwCioG5NwHQw">precision-recallæ›²çº¿</a>ã€‚ç›¸æ¯”äºROCæ›²çº¿ï¼ŒPRCæ›²çº¿æ›´é€‚åˆç±»åˆ«ä¸å¹³è¡¡çš„æƒ…å†µã€‚æˆ‘ä»¬ä¸»è¦é€‰æ‹©PRCæ›²çº¿æœ€é è¿‘å³ä¸Šè§’çš„ç‚¹ä½œä¸ºæœ€ä¼˜é˜ˆå€¼ã€‚</p>
<div id="cell-threshold-prc" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://leslie-lu.github.io/blog/2024/05/11/optimal_threshold/index_files/figure-html/threshold-prc-output-1.png" id="threshold-prc" class="quarto-figure quarto-figure-center anchored figure-img" width="445" height="447"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Selected threshold using precision-recall curve: 0.674.</code></pre>
</div>
</div>
</section>
<section id="åˆ†åˆ«å…³æ³¨precisionå’Œrecall" class="level4">
<h4 class="anchored" data-anchor-id="åˆ†åˆ«å…³æ³¨precisionå’Œrecall">5. åˆ†åˆ«å…³æ³¨precisionå’Œrecall</h4>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´é˜ˆå€¼æ¥åˆ†åˆ«å…³æ³¨precisionå’Œrecallã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´é˜ˆå€¼æ¥æé«˜recallï¼Œå‡å°‘å‡é˜´æ€§çš„æƒ…å†µã€‚</p>
<div id="cell-threshold-pre-recall" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://leslie-lu.github.io/blog/2024/05/11/optimal_threshold/index_files/figure-html/threshold-pre-recall-output-1.png" id="threshold-pre-recall" class="quarto-figure quarto-figure-center anchored figure-img" width="614" height="374"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>ä»£ç å·²ç»æ”¾è¿›äº†<a href="https://mp.weixin.qq.com/s/4IR-KMAZ-q2VbI0Fz4fYRg">æ˜Ÿçƒ</a>é‡Œã€‚</p>
<p><br></p>
<section id="did-you-find-this-page-helpful-consider-sharing-it" class="level5">
<h5 class="anchored" data-anchor-id="did-you-find-this-page-helpful-consider-sharing-it">Did you find this page helpful? Consider sharing it ğŸ™Œ</h5>


<!-- -->

</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{lu2024,
  author = {Lu, Zhen},
  title = {æœ€ä¼˜åˆ†ç±»é˜ˆå€¼},
  date = {2024-05-11},
  url = {https://leslie-lu.github.io//blog/2024/05/11/optimal_threshold},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-lu2024" class="csl-entry quarto-appendix-citeas">
Lu, Zhen. 2024. <span>â€œæœ€ä¼˜åˆ†ç±»é˜ˆå€¼.â€</span> May 11, 2024. <a href="https://leslie-lu.github.io//blog/2024/05/11/optimal_threshold">https://leslie-lu.github.io//blog/2024/05/11/optimal_threshold</a>.
</div></div></section></div> ]]></description>
  <category>python</category>
  <category>machine learning</category>
  <guid>https://leslie-lu.github.io/blog/2024/05/11/optimal_threshold/</guid>
  <pubDate>Sat, 11 May 2024 00:00:00 GMT</pubDate>
  <media:content url="https://cdn.jsdelivr.net/gh/Leslie-Lu/WeChatOfficialAccount/img/202405112020810.png" medium="image" type="image/png"/>
</item>
</channel>
</rss>
